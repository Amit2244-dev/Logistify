<div class="fixed inset-0 flex items-center justify-center bg-black/50 z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-lg mx-4 overflow-y-auto max-h-[91vh]">

    <!-- Close Button -->
    <div class="flex justify-end mt-[-10px]">
      <button mat-icon-button (click)="onClose()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Header -->
    <h2 class="text-[16px] font-semibold text-center mt-[-16px] mb-4">
      Update User
    </h2>

    <!-- Form -->
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6">

      <!-- Full Name -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Full Name</mat-label>
        <input matInput formControlName="fullName">
        <mat-error *ngIf="userForm.get('fullName')?.hasError('required')">
          Full Name is required
        </mat-error>
      </mat-form-field>

      <!-- Email -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" [readonly]="true">
        <mat-error *ngIf="userForm.get('email')?.hasError('required')">
          Email is required
        </mat-error>
        <mat-error *ngIf="userForm.get('email')?.hasError('email')">
          Enter a valid email
        </mat-error>
      </mat-form-field>

      <!-- Organization -->
      <mat-form-field appearance="fill" class="w-full">
          <mat-label>Organization Name</mat-label>
          <mat-select formControlName="organizationId" placeholder="Select Organization">
            <mat-option *ngFor="let option of organizationOptions" [value]="option.id">
              {{ option.key }}
            </mat-option>
          </mat-select>
        </mat-form-field>

      <!-- Roles -->
      <!-- Roles Multi-Select -->
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Roles</mat-label>
        <mat-select formControlName="roles" [disabled]="mode==='view'" multiple>
          <mat-option *ngFor="let role of availableRoles" [value]="role">{{ role }}</mat-option>
        </mat-select>
        <mat-error *ngIf="userForm.get('roles')?.hasError('required')">
          At least one role is required
        </mat-error>
      </mat-form-field>

      <!-- Submit -->
      <button type="submit" class="flex items-center gap-2 px-4 py-2 bg-[#9810fa] text-white rounded cursor-pointer">
        Save
      </button>
    </form>
    @if (loading) {
    <div class="flex justify-center items-center absolute h-full w-full bg-[#33333399] top-0 left-0 rounded-lg">
      <mat-spinner [diameter]="50"></mat-spinner>
    </div>
    }
  </div>
</div>